# 流水线

## 1. 背景

1. 需要更快的性能：超算、模拟、量子系统、深度学习、云计算、3A游戏……
2. 需要从时间和空间上更好地利用CPU（CPU大部分时间都处于空闲状态）

## 2. 流水线技术（Pipeline）的定义

> # 将一重复的处理过程分解成若干字过程，每个子过程都可以有效地在其专用功能段上与其他子过程同时执行。

## 3. 特点

1. 大量可分解的重复劳动

2. 交错式复用处理部件

3. 需要冷启动时间，冷启动后才能稳定
4. 子过程称为流水线的“级”或 ==“段”（stage）==，段的数目称为流水线的“深度”
5. 每个子过程的时间段应该基本相同，通常为一个时钟周期（1拍）

## 4. 分类

### 4.1. 功能：单功能、多功能

- 单功能：只能完成一种固定功能的流水线
- 多功能：各段可以进行不同的连接，从而实现不同的功能
  - ![image-20210914092725170](https://raw.githubusercontent.com/MrZLeo/Image/main/uPic/2021/09/14/image-20210914092725170.png)

### 4.2. 同一时间内流水段的连接方式：静态、动态

- 静态流水线：指同一时间内，流水线的各段只能按同一种功能的连接方式工作
- 动态流水线：在同一时间内，当某些段正在实现某种运算的时候，另一段却在实现另一种运算
- 特点：前者适合处理一串相同的运算操作，后者更灵活但会使流水线的控制变得很复杂

### 4.3 级别：处理器级、部件级、宏级（处理机间）

- 处理器级：取指、译码、取操作数、执行、访存、写回
- 部件级：一个单一部件内进行（e.g. 浮点加法分为求阶差、对阶、尾数相加、规格化四步）
- ![image-20210914094328408](https://raw.githubusercontent.com/MrZLeo/Image/main/uPic/2021/09/14/image-20210914094328408.png)
- 系统级流水线（宏级）：在多个计算机系统中由多个处理机串行构成的流水线
- ![image-20210914094340833](https://raw.githubusercontent.com/MrZLeo/Image/main/uPic/2021/09/14/image-20210914094340833.png)

### 4.4 反馈回路：线性、非线性

- 线性：无反馈回路
- 非线性：有反馈回路（i.e. 存在直通技术）
- ![image-20210914094454077](https://raw.githubusercontent.com/MrZLeo/Image/main/uPic/2021/09/14/image-20210914094454077.png)

### 4.5 输入与输出顺序：顺序、乱序

- 顺序：`input == output`
- 乱序：`input != output`

### 4.6 标量与向量流水线

- 标量：只能对标量数据进行计算
- 向量：单指令多数据：GPU、TPU、AVX指令集……

